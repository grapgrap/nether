# Plan

설계 또는 외부 스펙을 실행 가능한 작업 단위로 분해한다.

## 목적

설계 또는 외부 스펙을, **실제 구현에 착수할 수 있는 작업 계획으로 전환**한다. 설계와 코드 사이의 간극을 메운다.

### 핵심 시나리오

- design이 완성되면, plan을 통해 구현에 필요한 작업 목록과 순서가 도출된다
- 외부 스펙이 주어지면, plan을 통해 작업을 분해하면서 concept/design/decision이 함께 도출된다
- 구현 중 plan을 참조하면, 현재 작업의 맥락과 다음 작업을 파악할 수 있다

## 동작 원리

<!-- How(구현 방법)가 아닌 What(무엇을 달성하는가)에 집중한다. -->

### 주요 개념

- **방향 감지**: 기존 loom 문서(concept, design) 존재 여부와 진입점으로 흐름을 판단
  - 정방향: design이 이미 존재하거나, `/loom.design`에서 핸드오버된 경우. 작업 분해에 집중
  - 역방향: 관련 concept/design이 없는 상태에서 외부 스펙이 입력된 경우. 작업 분해 과정에서 concept/design/decision을 함께 생성
- **맥락 확보**: 정방향에서는 design 문서와 관련 concept, decision을 읽어 설계 의도를 파악. 역방향에서는 외부 스펙을 입력으로 받음
- **작업 분해**: 설계를 **코드 초안을 작성할 수 있을 정도**의 작업 단위로 나눔. design의 모델링, 데이터 흐름, 비즈니스 로직 각 요소가 분해의 입력이 된다
- **순서와 의존**: 작업 간 선후 관계와 의존성을 정리하여 단계적으로 나열
- **연관관계 표기**: 병렬 진행 가능한 작업을 별도로 표기한다. 이는 작업 간 연관관계의 강도를 드러내는 장치이며, 병렬 수행 자체가 목적이 아니다
- **영속화**: plan 산출물을 `{scope}/.loom/plans/`에 파일로 저장한다. `.gitignore` 대상이며, 구현이 완료되면 소멸한다. 구현 계획은 구현으로 재산출되므로 git 기록에 남길 필요가 없지만, 세션 간 맥락 유지를 위해 로컬 파일시스템에 존재한다
- **코파일럿**: plan 파일이 존재할 때 에이전트가 구현을 지원하는 동작. 두 축으로 구성된다:
  - 프로모터: 구현 중 모호한 부분을 해소한다. 사용자가 제시하는 정보와 plan 맥락을 결합하여 판단을 돕는다
  - 가이드라인: concept/design/decision에 정렬되지 않는 판단을 견제한다. 프로젝트가 설계 의도의 바깥으로 나가지 않도록 한다
- **판단 우선순위**: 코파일럿이 판단을 내릴 때, 기록된 설계 의도(concept/design/decision)를 사용자의 즉석 판단보다 우선한다. 설계 의도를 변경하려면 해당 loom 문서를 먼저 수정해야 한다

### 핵심 동작

- **계획 수립**: design 또는 외부 스펙을 기반으로 작업을 도출하고 의존성에 따라 순서를 결정
- **맥락 주입**: 정방향에서는 loom 문서(concept, design, decision)를 자동으로 읽어 plan에 반영
- **산출물 생성**: 역방향에서는 작업 분해 과정에서 파악된 핵심 개념과 설계를 concept/design/decision 문서로 생성
- **plan 파일 생성**: plan mode 완료 후 작업 목록을 `{scope}/.loom/plans/`에 기록. 관련 concept/design/decision 경로를 참조로 포함
- **코파일럿 지원**: 활성 plan 파일이 존재할 때, 에이전트는 구현 맥락을 제공하고 설계 정렬을 견제한다. 작업 완료 시 진행 상태를 갱신한다

## 경계

- plan 파일은 구현이 완료되면 소멸한다 (git에 커밋되지 않음)
- 코드를 직접 작성하지 않는다 (구현 자체는 plan 이후)
- 코파일럿은 구현을 대행하지 않는다 (판단 지원만 수행)
- 병렬성은 연관관계의 강도를 드러내는 정보이지, 동시 실행을 지시하는 것이 아니다
- 정방향에서는 What/Why 정의([[concept]]에서), How 설계([[design]]에서)를 직접 다루지 않는다
- 역방향에서는 작업 분해 과정의 부산물로 concept/design/decision을 생성할 수 있다

## 하위 컨셉

없음

## 관련 컨셉

- [[design]] - 정방향에서는 plan의 입력, 역방향에서는 plan의 산출물
- [[concept]] - 정방향에서는 plan이 참조하는 원래 의도(What/Why), 역방향에서는 plan의 산출물
- [[decision]] - plan 수립 시 이전 결정 맥락을 참고. 역방향에서는 plan 과정의 선택을 기록

## 결정 로그

- [[../decisions/2026-02-12-plan-컨셉-도입]]
- [[../decisions/2026-02-12-plan-작업분해-기준]]
- [[../decisions/2026-02-14-plan-역방향-흐름-도입]]
- [[../decisions/2026-02-14-plan-커맨드-도입]]
- [[../decisions/2026-02-14-plan-영속화-및-코파일럿]]
