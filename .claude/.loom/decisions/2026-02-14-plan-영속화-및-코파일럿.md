# 2026-02-14-plan-영속화-및-코파일럿

## 맥락

plan의 산출물(구현 계획)이 비영속이어서 세션이 바뀌면 맥락이 끊겼다. 에이전트가 구현 과정에서 코파일럿 역할을 수행하려면 plan을 세션 독립적으로 참조할 수 있어야 했다. 기존 결정([[2026-02-12-plan-컨셉-도입]])에서는 "영속 문서 불필요"로 판단했으나, 실제 사용에서 세션 간 맥락 단절이 병목이 되었다.

## 결정 내용

### 1. plan 파일 영속화

plan 산출물을 `{scope}/.loom/plans/`에 파일로 저장한다. `.gitignore` 대상이므로 git 기록에는 남지 않으며, 구현이 완료되면 소멸한다. 구현 계획은 구현으로 재산출되므로 커밋할 필요가 없지만, 세션 간 맥락 유지를 위해 로컬 파일시스템에 존재해야 한다.

### 2. 코파일럿 동작 정의

plan 파일이 존재할 때 에이전트의 구현 지원 동작을 정의한다:

- **촉진자**: 구현 중 모호한 부분을 해소
- **수호자**: concept/design/decision에 정렬되지 않는 판단을 견제
- **판단 우선순위**: 기록된 설계 의도 > 사용자의 즉석 판단

### 3. 코파일럿 정의 위치

코파일럿 동작은 loom 시스템 내부(plan 컨셉 문서 + 커맨드 스펙)에서 정의한다. CLAUDE.md는 loom 시스템으로의 포인터만 둔다.

### 제약 조건

- plan 파일은 `.loom/` 내부에 위치하되 `.gitignore`로 버전 관리에서 제외
- 코파일럿 동작은 loom 시스템 안에서 정의 (CLAUDE.md에 전가하지 않음)
- 기존 plan 컨셉의 경계(코드를 직접 작성하지 않음)는 유지

### 전제 조건

- plan 파일의 내용이 관련 concept/design/decision에 강하게 종속되므로 `.loom/` 내부에 위치하는 것이 구조적으로 자연스럽다
- 에이전트가 `.loom/plans/`를 탐색하면 활성 계획을 발견할 수 있다

## 대안

### decision 문서에 Claude plan file 링크

- 설명: Claude plan mode가 생성하는 plan file 경로를 decision 문서에서 링크로 참조
- 트레이드오프: Claude의 plan mode 구현에 종속되어 loom 시스템의 독립성을 해친다. plan file의 생명주기를 loom이 제어할 수 없다

### CLAUDE.md에 코파일럿 동작 정의

- 설명: CLAUDE.md의 AI 어시스턴트 안내에 코파일럿 동작 원칙을 직접 기술
- 트레이드오프: loom 시스템의 특성이 CLAUDE.md로 전가된다. loom이 자신의 동작을 정의하지 못하고 외부 문서에 의존하게 된다

### `.loom/` 바깥에 plan 파일 저장 (`{scope}/.plans/`)

- 설명: `.loom/` 디렉토리 바깥에 별도 디렉토리를 두어 버전 관리 일관성 유지
- 트레이드오프: plan 내용이 concept/design/decision에 강하게 종속되므로 구조적으로 분리하면 관계가 드러나지 않는다

## 영향받는 컨셉

- [[plan]] - 영속화 및 코파일럿 동작 추가. 경계 수정 (비영속 → `.gitignore` 대상 파일)
